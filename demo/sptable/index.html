<!DOCTYPE html>
<html ng-app="myApp">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <title>sptable</title>
    <link href="../../src/css/animations.css" rel="stylesheet">
    <!-- <link href="../../src/css/wall.css" rel="stylesheet"> -->
    <script src="../../src/lib/angular.js"></script>
    <script src="../../src/lib/angular-animate.js"></script>
    <script src="../../src/module/util/Array.js"></script>
    <script src="../../src/module/sptable/sptable.js"></script>
    <style>
    .spgrid {
        display: inline-block;
        vertical-align: top;
    }
    
    .sptable {
        width: 90%;
    }
    
    .sptool-v {
        width: 7%;
    }
    
    .sptool-v >button {
        margin-top: 3px;
        margin-bottom: 110px;
    }
    
    .spitem {
        width: 200px;
        height: 130px;
        display: inline-block;
        /*margin: 2px;*/
        /*border: 1px solid #d2d2d2;*/
        overflow: auto;
    }
    
    .spitem > div {
        margin: 2px;
        padding: 4px;
        height: auto;
        background-color: rgb(237, 240, 231);
        border: 1px solid #d2d2d2;
        height: 80%;
    }
    
    .spitem .item-isdel {
        display: none;
    }
    
    .spitem .item-invalid {
        background-color: #ffd800;
    }
    
    .spitem input {
        width: 60%;
    }
    </style>
</head>

<body ng-controller="demoCtrl">
    <div>
        <div class="sptable spgrid" nd-sptable sp-arr="data" row-field="row" scale-field="scale" isdel-field="isDel" width-unit="sc" width-px="500">
            <div class="spitem" nd-spitem ng-repeat="d in data" sp-item="d" scale-field="scale" isdel-field="isDel" ng-show="!d.isDel">
                <div>
                    <div>id:{{d.id}}</div>
                    <div>row:{{d.row}}</div>
                    <!--<input type="number" ng-model="d.scale" ng-model-options="{ updateOn: 'blur',debounce: 500 }"/> {{d.id}} -->
                    <input type="number" ng-model="d.scale" ng-disabled="!d.isEft" /> {{d.id}}
                </div>
            </div>
        </div>
        <div class="sptool-v spgrid">
            <button type="button" ng-click="addItem(1)">添加</button>
            <button type="button" ng-click="addItem(2)">添加</button>
        </div>
    </div>
    <button type="button" ng-click="insert()">insert</button>
    <button type="button" ng-click="del()">del</button>
    <script>
    var app = angular.module('myApp', ['nd.sptable']);

    app.controller('demoCtrl', ['$scope', function($scope) {

        $scope.data = [{
            id: 1,
            row: 1,
            scale: 10,
            isDel: false,
            isEft: true
        }, {
            id: 2,
            row: 1,
            scale: 50,
            isDel: false,
            isEft: false
        }, {
            id: 3,
            row: 2,
            scale: 40,
            isDel: false,
            isEft: true
        }, {
            id: 4,
            row: 2,
            scale: 40,
            isDel: true,
            isEft: true
        }, {
            id: 5,
            row: 2,
            scale: 40,
            isDel: false,
            isEft: true
        }];

        //
        $scope.addItem = function(rowIndex) {
            var itemsInRowAll = $scope.data.filter('row', rowIndex);

            $scope.data.splice(itemsInRowAll[0].nextIndex, 0, {
                id: 0,
                row: rowIndex,
                scale: 20,
                isDel: false,
                isEft: true
            });
        };

        //
        $scope.insert = function() {
            $scope.data.splice(2, 0, {
                id: 0,
                row: 1,
                scale: 20,
                isDel: false,
                isEft: true
            });

            // $scope.data.push({
            //     id: 0,
            //     row: 2,
            //     scale: 30
            // });

            // $scope.data.push({
            //     id: 0,
            //     row: 3,
            //     scale: 30
            // });

            // $scope.data[0].scale = 50;

            // $scope.data[0].scale = 50;
            // $scope.$digest();
        };

        $scope.del = function() {
            $scope.data[0].isDel = true;
        };
    }]);
    </script>
</body>

</html>
