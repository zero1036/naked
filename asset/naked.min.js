angular.module("ui.nd",["nd.wall","nd.sptable","nd.rollback"]),angular.module("nd.rollback",[]).directive("ndModelCommit",["$parse",function(e){return{restrict:"A",link:function(n,t,r){t.bind("click",function(){var t=angular.isDefined(r.action)?e(r.action):angular.noop,i=angular.isDefined(r.validation)?e(r.validation):angular.noop,o=angular.isDefined(r.commit)&&"true"===r.commit?!0:!1;n.$emit("ngModelActionRollback",o,i),t(n),n.$apply()})}}}]).directive("ndModelRollback",function(){return{restrict:"A",scope:!1,require:"?ngModel",priority:20,link:function(e,n,t,r){var i=null;e.$on("ngModelActionRollback",function(n,t,i){t&&(t=i(e,{vm:r.$viewValue})),t?(r.$commitViewValue(),r.$render(),e.$apply()):(r.$rollbackViewValue(),r.$render())}),n.bind("blur",function(e){i=r.$viewValue,r.$rollbackViewValue(),r.$setViewValue(i),r.$render()})}}}),angular.module("nd.sptable",["ngAnimate"]).directive("ndSptable",function(){return{scope:{spArr:"=",spRow:"=",isLog:"@"},controller:"ndSptableCtrl"}}).controller("ndSptableCtrl",["$scope","$element","$attrs","$transclude","$parse",function(e,n,t,r,i){function o(e){for(var n,r=0,i=0;n=e[i++];){var o=n[t.scaleField];r+=o}return r}function l(e,n){var r=e[t.scaleField];angular.isDefined(t.widthUnit)&&angular.isDefined(t.widthPx)&&"px"===t.widthUnit?(e.width=parseInt(t.widthPx)*r/n,e.width=e.width+"px"):r===n&&0===r?e.width="100%":(e.width=r/n*100,e.width=e.width+"%")}function a(e){console.log("validate sptable");for(var n,r=null,i=0;n=e[i++];)null!==r&&r>n[t.rowField]&&console.log("！！！！sptable数据异常！！！！"),r=n[t.rowField],console.log("i:"+i+" | row:"+n[t.rowField]+" | isDel:"+n[t.isdelField]),"[object Number]"!=Object.prototype.toString.call(n[t.scaleField])&&console.log("！！！！对象属性"+t.scaleField+"只能为数值！！！！")}angular.isDefined(t.rowField)&&angular.isDefined(t.scaleField)&&angular.isDefined(t.isdelField)&&(this.refreshArr=function(n,r){if(void 0!==n||(n=e.spArr,void 0!==n)){var s=angular.isDefined(t.onValidate)?i(t.onValidate):angular.noop;e.spRow=0;for(var u=1;10>=u;u++){var c=n.filter(t.rowField,u);if(0===c.length)break;var d=c.filter(t.isdelField,!1);0!==d.length&&(e.spRow+=1);for(var g,p=o(d),f=s(e.$parent,{items:d}),h=0;g=c[h++];)g[t.isdelField]===!1&&l(g,p),g[t.rowField]=e.spRow,g.warn=void 0===f?!1:f}e.isLog&&a(n)}},e.$watchCollection("spArr",this.refreshArr))}]).directive("ndSpitem",function(){return{require:["?^ndSptable","?^ndSpitem"],scope:{spItem:"="},controller:"ndSpitemCtrl",link:function(e,n,t,r){r[1].refreshParentArr=r[0].refreshArr}}}).controller("ndSpitemCtrl",["$scope","$element","$attrs","$transclude",function(e,n,t,r){this.refreshParentArr=angular.loop;var i=this;e.$watch(function(e){return e.spItem.width},function(e){n[0].style.width=e}),e.$watch(function(e){return e.spItem.warn},function(e){if(void 0!==e){var t=angular.element(n);e?t.addClass("spitem-warn"):t.removeClass("spitem-warn")}}),e.$watch(function(e){return e.spItem[t.scaleField]},function(e,n){if(e!==n){if(0===e)return;i.refreshParentArr()}}),e.$watch(function(e){return e.spItem[t.isdelField]},function(e,n){e!==n&&e&&i.refreshParentArr()})}]),function(){Array.prototype.single=function(e,n){for(var t,r=0;t=this[r++];)if(t[e]===n)return t;return void 0},Array.prototype.filter=function(e,n){for(var t,r=[],i=0;t=this[i++];)t[e]==n&&r.push(t);return r},Array.prototype.indexOf4Pro=function(e,n){for(var t,r=0;t=this[r++];)if(t[e]==n)return r-1;return-1},Array.prototype.contains=function(e){return this.indexOf(e)>=0},Array.prototype.resortNumber=function(e,n,t){for(var r,i=0;r=this[i++];)t(r)?(r[e]=n,n+=1):r[e]=-1}}(),function(){Date.prototype.Format=function(e){var n={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in n)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[t]:("00"+n[t]).substr((""+n[t]).length)));return e}}();var ut=angular.module("nd.util",[]);ut.factory("$$util",function(){var e={};return e.lastName=function(e,n){var t=/(\\+)/g,r=e.replace(t,"#"),i=r.split("#"),o=i[i.length-1],l=o.split("."),a=l[l.length-1],s=n.indexOf(a);return s>=0?!0:(alert("您选择的上传文件不是有效的图片文件！"),!1)},e.getChecked=function(e,n){var t="";if(null===e)return"";for(var r,i=0;r=e[i++];)r.isChecked&&(t+=r[n]+",");return t.length>0&&(t=t.substring(0,t.length-1)),t},e.sort=function(e,n){return e.sort(function(e,t){return e[n]-t[n]})},Date.prototype.Format=function(e){var n={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in n)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[t]:("00"+n[t]).substr((""+n[t]).length)));return e},e}),angular.module("nd.wall",["ngAnimate"]).constant("wallConfig",{openClass:"open"}).service("wallService",["$document","$rootScope",function(e,n){var t=null;this.open=function(n,i){t||e.bind("touchstart",r),t&&t!==n&&i&&1==i&&(t.isOpen=!1),t=n},this.close=function(n){t===n&&(t=null,e.unbind("click",r))};var r=function(e){if(t&&(!e||"disabled"!==t.getAutoClose())){var r=t.getToggleElement();if(!(e&&r&&r[0].contains(e.target))){var i=t.getDropdownElement();e&&"outsideClick"===t.getAutoClose()&&i&&i[0].contains(e.target)||(t.isOpen=!1,n.$$phase||t.$apply())}}}}]).controller("ndWallCtrl",["$scope","$attrs","$parse","wallConfig","wallService","$animate","$document","$compile","$templateRequest",function(e,n,t,r,i,o,l,a,s){var u,c=this,d=e.$new(),g=r.openClass,p=angular.noop,f=n.onToggle?t(n.onToggle):angular.noop,h=(l.find("body"),angular.isDefined(n.isOnly)?n.isOnly:!0);this.init=function(r){c.$element=r,n.isOpen&&(u=t(n.isOpen),p=u.assign,e.$watch(u,function(e){d.isOpen=!!e}))},this.toggle=function(e){return d.isOpen=arguments.length?!!e:!d.isOpen},this.isOpen=function(){return d.isOpen},d.getToggleElement=function(){return c.toggleElement},d.getAutoClose=function(){return n.autoClose||"always"},d.getElement=function(){return c.$element},d.getDropdownElement=function(){return c.dropdownMenu},d.focusToggleElement=function(){c.toggleElement&&c.toggleElement[0].focus()},d.$watch("isOpen",function(n,t){var r=c.$element;o[n?"addClass":"removeClass"](r,g).then(function(){angular.isDefined(n)&&n!==t&&f(e,{open:!!n})}),n?(d.focusToggleElement(),i.open(d,h)):i.close(d),angular.isFunction(p)&&p(e,n)}),e.$on("$locationChangeSuccess",function(){"disabled"!==d.getAutoClose()&&(d.isOpen=!1)});var $=e.$on("$destroy",function(){d.$destroy()});d.$on("$destroy",$)}]).directive("ndWall",function(){return{controller:"ndWallCtrl",link:function(e,n,t,r){r.init(n),n.addClass("nd-wall")}}}).directive("ndWallTogglePub",["$parse",function(e){return{link:function(n,t,r,i){if(angular.isDefined(r.isOpen)){var o,l=angular.noop;o=e(r.isOpen),l=o.assign;var a=function(e){e.preventDefault(),e.stopPropagation();var t=o(n);n.$apply(function(){l(n,!t)})};t.bind("click",a)}}}}]).directive("ndWallToggle",function(){return{require:"?^ndWall",link:function(e,n,t,r){if(r){n.addClass("nd-wall-toggle"),r.toggleElement=n;var i=function(i){i.preventDefault(),n.hasClass("disabled")||t.disabled||e.$apply(function(){r.toggle()})};n.bind("click",i),n.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(r.isOpen,function(e){n.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){n.unbind("click",i)})}}}});