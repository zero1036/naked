angular.module("ui.nd",["nd.wall","nd.sptable"]),angular.module("nd.sptable",["ngAnimate"]).directive("ndSptable",function(){return{scope:{spArr:"=",spRow:"="},controller:"ndSptableCtrl"}}).controller("ndSptableCtrl",["$scope","$element","$attrs","$transclude",function(e,t,n,r){function i(e){for(var t,r=0,i=0;t=e[i++];){var o=t[n.scaleField];r+=o}return r}function o(e,t){var r=e[n.scaleField];angular.isDefined(n.widthUnit)&&angular.isDefined(n.widthPx)&&"px"===n.widthUnit?(e.width=parseInt(n.widthPx)*r/t,e.width=e.width+"px"):(e.width=r/t*100,e.width=e.width+"%")}angular.isDefined(n.rowField)&&angular.isDefined(n.scaleField)&&angular.isDefined(n.isdelField)&&(this.refreshArr=function(t,r){if(void 0!==t||(t=e.spArr,void 0!==t)){var l=0;e.spRow=0;for(var a=1;10>=a;a++){var s=t.filter(n.rowField,a);if(0===s.length)return;var u=s.filter(n.isdelField,!1);0!==u.length&&(e.spRow+=1),l+=s.length;for(var c,d=i(u),g=0;c=s[g++];)c[n.isdelField]===!1&&o(c,d),c.nextIndex=l}}},e.$watchCollection("spArr",this.refreshArr))}]).directive("ndSpitem",function(){return{require:["?^ndSptable","?^ndSpitem"],scope:{spItem:"="},controller:"ndSpitemCtrl",link:function(e,t,n,r){r[1].refreshParentArr=r[0].refreshArr}}}).controller("ndSpitemCtrl",["$scope","$element","$attrs","$transclude",function(e,t,n,r){this.refreshParentArr=angular.loop;var i=this;e.$watch(function(e){return e.spItem.width},function(e){t[0].style.width=e}),e.$watch(function(e){return e.spItem[n.scaleField]},function(e,t){e!==t&&i.refreshParentArr()}),e.$watch(function(e){return e.spItem[n.isdelField]},function(e,t){e!==t&&e&&i.refreshParentArr()})}]),angular.module("nd.wall",["ngAnimate"]).constant("wallConfig",{openClass:"open"}).service("wallService",["$document","$rootScope",function(e,t){var n=null;this.open=function(t,i){n||e.bind("touchstart",r),n&&n!==t&&i&&1==i&&(n.isOpen=!1),n=t},this.close=function(t){n===t&&(n=null,e.unbind("click",r))};var r=function(e){if(n&&(!e||"disabled"!==n.getAutoClose())){var r=n.getToggleElement();if(!(e&&r&&r[0].contains(e.target))){var i=n.getDropdownElement();e&&"outsideClick"===n.getAutoClose()&&i&&i[0].contains(e.target)||(n.isOpen=!1,t.$$phase||n.$apply())}}}}]).controller("ndWallCtrl",["$scope","$attrs","$parse","wallConfig","wallService","$animate","$document","$compile","$templateRequest",function(e,t,n,r,i,o,l,a,s){var u,c=this,d=e.$new(),g=r.openClass,f=angular.noop,p=t.onToggle?n(t.onToggle):angular.noop,h=(l.find("body"),angular.isDefined(t.isOnly)?t.isOnly:!0);this.init=function(r){c.$element=r,t.isOpen&&(u=n(t.isOpen),f=u.assign,e.$watch(u,function(e){d.isOpen=!!e}))},this.toggle=function(e){return d.isOpen=arguments.length?!!e:!d.isOpen},this.isOpen=function(){return d.isOpen},d.getToggleElement=function(){return c.toggleElement},d.getAutoClose=function(){return t.autoClose||"always"},d.getElement=function(){return c.$element},d.getDropdownElement=function(){return c.dropdownMenu},d.focusToggleElement=function(){c.toggleElement&&c.toggleElement[0].focus()},d.$watch("isOpen",function(t,n){var r=c.$element;o[t?"addClass":"removeClass"](r,g).then(function(){angular.isDefined(t)&&t!==n&&p(e,{open:!!t})}),t?(d.focusToggleElement(),i.open(d,h)):i.close(d),angular.isFunction(f)&&f(e,t)}),e.$on("$locationChangeSuccess",function(){"disabled"!==d.getAutoClose()&&(d.isOpen=!1)});var $=e.$on("$destroy",function(){d.$destroy()});d.$on("$destroy",$)}]).directive("ndWall",function(){return{controller:"ndWallCtrl",link:function(e,t,n,r){r.init(t),t.addClass("nd-wall")}}}).directive("ndWallTogglePub",["$parse",function(e){return{link:function(t,n,r,i){if(angular.isDefined(r.isOpen)){var o,l=angular.noop;o=e(r.isOpen),l=o.assign;var a=function(e){e.preventDefault(),e.stopPropagation();var n=o(t);t.$apply(function(){l(t,!n)})};n.bind("click",a)}}}}]).directive("ndWallToggle",function(){return{require:"?^ndWall",link:function(e,t,n,r){if(r){t.addClass("nd-wall-toggle"),r.toggleElement=t;var i=function(i){i.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){r.toggle()})};t.bind("click",i),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(r.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",i)})}}}}),function(){Array.prototype.single=function(e,t){for(var n,r=0;n=this[r++];)if(n[e]===t)return n;return void 0},Array.prototype.filter=function(e,t){for(var n,r=[],i=0;n=this[i++];)n[e]==t&&r.push(n);return r},Array.prototype.indexOf4Pro=function(e,t){for(var n,r=0;n=this[r++];)if(n[e]==t)return r-1;return-1},Array.prototype.contains=function(e){return this.indexOf(e)>=0},Array.prototype.resortNumber=function(e,t,n){for(var r,i=0;r=this[i++];)n(r)?(r[e]=t,t+=1):r[e]=-1}}(),function(){Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}}();var ut=angular.module("nd.util",[]);ut.factory("$$util",function(){var e={};return e.lastName=function(e,t){var n=/(\\+)/g,r=e.replace(n,"#"),i=r.split("#"),o=i[i.length-1],l=o.split("."),a=l[l.length-1],s=t.indexOf(a);return s>=0?!0:(alert("您选择的上传文件不是有效的图片文件！"),!1)},e.getChecked=function(e,t){var n="";if(null===e)return"";for(var r,i=0;r=e[i++];)r.isChecked&&(n+=r[t]+",");return n.length>0&&(n=n.substring(0,n.length-1)),n},e.sort=function(e,t){return e.sort(function(e,n){return e[t]-n[t]})},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},e});